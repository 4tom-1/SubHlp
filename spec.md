# サブ助 仕様書

---

## 1. 要件定義

### 1.1 サービス概要
- 複数のサブスクリプション契約（例：Netflix, Spotify等）を一元管理できるWebアプリ。
- 月額・年額支出の可視化、支払いリマインド、サービス比較、解約ガイド等を提供。
- ユーザーは自身のサブスクリプション情報・支払い方法を登録・編集・削除できる。

### 1.2 ユーザー要件
- サブスクリプションの追加・編集・削除
- 支払い方法の追加・編集・削除
- 月額・年額合計の自動算出
- サブスクリプションの状態管理（利用中・一時停止・解約済み等）
- 支払いリマインド通知設定
- サービス比較・解約ガイドの参照
- 認証（メール/パスワード、Google, Microsoft, Twitter(X)）
- セキュリティ（ログイン試行制限、アカウントロック、アカウント連携）

### 1.3 システム要件
- フロントエンド：Next.js（v0.dev UI生成）、TypeScript
- バックエンド：Firebase（Firestore, Authentication）
- デプロイ：Vercel

---

## 2. 設計書

### 2.1 画面設計（主要画面）

- ログイン画面
  - メール/パスワード、Google, Microsoft, Twitter(X)認証
  - サインアップ・パスワードリセット
  - ログイン試行制限・Turnstile（bot対策）・アカウントロック
- ダッシュボード
  - サブスクリプション一覧（編集・削除・解約ガイド）
  - 月額・年額合計表示
  - サブスクリプション追加・編集フォーム
  - 支払い方法管理
  - 通知設定
  - サービス比較
- サブスクリプション追加・編集フォーム
  - サービス名、カテゴリ、金額、支払いサイクル、次回支払日、支払い方法、状態、色
  - サービス名自動補完・カテゴリ自動設定
- 支払い方法管理
  - クレジットカード等の登録・編集・削除・デフォルト設定

### 2.2 データ設計

#### サブスクリプション（Subscription）
| フィールド名         | 型         | 説明                                 |
|----------------------|------------|--------------------------------------|
| id                   | string     | サブスクリプションID                 |
| name                 | string     | サービス名                           |
| price                | number     | 金額                                 |
| billingCycle         | enum       | "monthly" / "yearly" / "trial"等     |
| nextPayment          | string     | 次回支払日（YYYY-MM-DD）             |
| category             | string     | カテゴリ                             |
| color                | string     | 表示色                               |
| status               | enum       | "active" / "paused" / ...            |
| paymentMethodId      | string     | 支払い方法ID（任意）                 |

#### 支払い方法（PaymentMethod）
| フィールド名         | 型         | 説明                                 |
|----------------------|------------|--------------------------------------|
| id                   | string     | 支払い方法ID                         |
| type                 | enum       | "credit_card"等                      |
| name                 | string     | 名称                                 |
| lastFourDigits       | string     | 下4桁（任意）                        |
| expiryDate           | string     | 有効期限（任意）                     |
| isDefault            | boolean    | デフォルトかどうか                   |
| createdAt            | string     | 登録日時                             |

#### 通知設定（NotificationSettings）
| フィールド名         | 型         | 説明                                 |
|----------------------|------------|--------------------------------------|
| email                | boolean    | メール通知ON/OFF                     |
| browser              | boolean    | ブラウザ通知ON/OFF                   |
| daysBeforePayment    | number     | 何日前に通知するか                   |

---

## 3. 実装定義

### 3.1 認証・ユーザー管理
- Firebase Authenticationを利用
- メール/パスワード、Google, Microsoft, Twitter(X)認証
- ログイン試行回数制限（5回で15分ロックアウト、SNSは3回で10分ロック）
- アカウント連携（異なる認証プロバイダーで同一メール時の連携ダイアログ）

### 3.2 サブスクリプション管理
- Firestoreにユーザーごとにサブスクリプション情報を保存
- サブスクリプション追加・編集・削除
- サービス名自動補完（プリセットサービスから検索・カテゴリ自動設定）
- 解約ガイドURL・手順の自動表示
- 月額・年額合計の自動計算

### 3.3 支払い方法管理
- Firestoreにユーザーごとに支払い方法を保存
- クレジットカード等の追加・編集・削除・デフォルト設定
- サブスクリプションと支払い方法の紐付け

### 3.4 通知・リマインド
- 支払い日リマインド（メール・ブラウザ通知）
- 通知日数設定

### 3.5 UI/UX
- v0.devによるモダンなUI
- レスポンシブデザイン
- ローディング・エラーハンドリング
- カラーピッカー、日付ピッカー等の入力補助

### 3.6 セキュリティ
- ログイン試行制限・Turnstile（bot対策）
- アカウントロックアウト
- Firebaseのセキュリティルール適用

---

## 4. kiro用spec cording例（抜粋）

### サブスクリプション追加機能

- ユーザーは「サブスクリプション追加」ボタンを押すとフォームが表示される
- サービス名を入力するとプリセットから自動補完・カテゴリ自動設定
- 金額、支払いサイクル、次回支払日、支払い方法、状態、色を入力
- 必須項目未入力・金額不正時はエラー表示
- 追加後、ダッシュボードに即時反映 
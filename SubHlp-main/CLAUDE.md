# CLAUDE.md

## このファイルの目的

このCLAUDE.mdは、サブ助プロジェクトの設計意図・ディレクトリ構成の思想・各層の役割・設計判断を明文化し、Claude Codeの自動レビューや質問管理の基準とするための「説明ファイル」です。

---

## 1. ディレクトリ・サブディレクトリ全体の設計方針

### 1-1. 全体構成の思想

- **Next.js（App Router構成）**をベースに、`app/`ディレクトリ配下にページ・レイアウト・グローバル状態管理（contexts）を集約。
- **UIコンポーネント**は`components/`に集約し、`ui/`サブディレクトリで汎用的なUIパーツ（Button, Card, Modal等）を管理。  サブ助独自の機能コンポーネント（dashboard, subscription-form等）は直下に配置。
- **hooks/**にはReactカスタムフック（Firestore操作、認証、サブスク管理等）を集約。
- **lib/**にはFirebase初期化やサブスクサービス定義、ユーティリティ関数など「ロジック・データ定義」を配置。
- **types/**には型定義（TypeScript interface等）を集約。
- **styles/**や`app/globals.css`にはグローバルなスタイル・テーマ変数を記述。
- **public/**には静的アセット（画像・利用規約・プライバシーポリシー等）を配置。

### 1-2. サブディレクトリごとの役割

- **app/**  
  - `app/layout.tsx`：全体レイアウト・テーマ・認証Providerのラップ
  - `app/page.tsx`：認証済みユーザー向けのダッシュボード（Dashboardコンポーネント呼び出し）
  - `app/login/`：ログインページ（認証UI・セキュリティ制御）
  - `app/contexts/`：グローバルな認証状態管理（AuthContext）
- **components/**  
  - `components/ui/`：汎用UIパーツ（Button, Card, Modal, Input等）
  - `components/`直下：サブ助独自の機能コンポーネント（dashboard, subscription-form, notification-settings等）
- **hooks/**  
  - Firestoreやサブスク管理、支払い方法管理などのカスタムフック
- **lib/**  
  - `firebase.ts`：Firebase初期化・Provider定義
  - `subscription-services.ts`：主要サブスクサービスの定義（ID, 名前, カテゴリ, 解約方法等）
  - `utils.ts`：汎用ユーティリティ関数
- **types/**  
  - サブスク情報等の型定義
- **public/**  
  - 画像・利用規約・プライバシーポリシー等の静的ファイル

### 1-3. 設計思想・判断

- **Design Tokensの一部思想**を取り入れ、UIパーツの再利用性・保守性を重視。
- **状態管理はContext API中心**（Redux等は未採用、規模・要件から不要と判断）。
- **Firebase中心のBaaS構成**（サーバーレス、認証・DB・ホスティング一元化）。
- **セキュリティ・ユーザビリティ両立**（レート制限・CAPTCHA・統一エラー・アカウント連携等）。
- **AIベースのUI生成（v0.dev）**を活用し、UI/UXの一貫性と迅速な開発を両立。

---

## 2. この構成・設計にした理由

- **保守性・拡張性**：機能ごと・責務ごとにディレクトリを分離し、将来的な機能追加やリファクタリングを容易にするため。
- **UI/UXの一貫性**：汎用UIパーツを`components/ui/`に集約し、全体のデザイン統一・再利用性を高めるため。
- **BaaS活用による開発効率化**：Firebaseを活用し、インフラ管理コストを削減しつつ、セキュアな認証・データ管理を実現。
- **AI活用**：v0.devによるUI自動生成で、デザイン・実装の手間を削減し、ユーザー体験の向上を目指す。

---

## 3. 今後の拡張・改善予定

- 多要素認証（TOTP/Google Authenticator等）対応
- サブスク比較機能の拡充
- 異常ログイン検知・ログイン履歴の記録
- サブスク自動検出（銀行・メール連携等）

---

## 4. 注意事項

- 本CLAUDE.mdの内容は、現状のディレクトリ構成・設計思想をもとに記載しています。  
  もし今後、設計方針やディレクトリ構成に大きな変更があった場合は、必ず本ファイルも更新してください。

---

### （根拠）
- README.mdの「概要」「技術スタック」「機能一覧」「セットアップ」等
- ディレクトリ・ファイル構成、ファイル名、実装内容
- components/ui/やlib/、hooks/等の存在・役割
- コードコメント・型定義・セキュリティガイドライン

---

この内容をCLAUDE.mdに記載することで、  
「このプロジェクトのディレクトリ・サブディレクトリ全体の設計方針」を明文化できます。  
もし今後、明示的な設計ドキュメントを追加する場合は、その内容を本ファイルにも反映してください。
